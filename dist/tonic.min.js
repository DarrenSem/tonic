var u=Object.defineProperty;var a=(d,e)=>u(d,"name",{value:e,configurable:!0});class TonicTemplate{constructor(e,t,r){this.isTonicTemplate=!0,this.unsafe=r,this.rawText=e,this.templateStrings=t}valueOf(){return this.rawText}toString(){return this.rawText}}a(TonicTemplate,"TonicTemplate");class Tonic extends window.HTMLElement{constructor(){super();const e=Tonic._states[super.id];delete Tonic._states[super.id],this._state=e||{},this.preventRenderOnReconnect=!1,this.props={},this.elements=[...this.children],this.elements.__children__=!0,this.nodes=[...this.childNodes],this.nodes.__children__=!0,this._events()}static _createId(){return`tonic${Tonic._index++}`}static _splitName(e){return e.match(/[A-Z][a-z0-9]*/g).join("-")}static _normalizeAttrs(e,t={}){return[...e].forEach(r=>t[r.name]=r.value),t}_checkId(){const e=super.id;if(!e){const t=this.outerHTML.replace(this.innerHTML,"...");throw new Error(`Component: ${t} has no id`)}return e}get state(){return this._checkId(),this._state}set state(e){this._state=(this._checkId(),e)}get id(){return this._checkId()}set id(e){super.id=e}_events(){const e=Object.getOwnPropertyNames(window.HTMLElement.prototype);for(const t of this._props)e.indexOf("on"+t)!==-1&&this.addEventListener(t,this)}_prop(e){const t=this._id,r=`__${t}__${Tonic._createId()}__`;return Tonic._data[t]=Tonic._data[t]||{},Tonic._data[t][r]=e,r}_placehold(e){const t=this._id,r=`placehold:${t}:${Tonic._createId()}__`;return Tonic._children[t]=Tonic._children[t]||{},Tonic._children[t][r]=e,r}static match(e,t){return e.matches||(e=e.parentElement),e.matches(t)?e:e.closest(t)}static getPropertyNames(e){const t=[];for(;e&&e!==Tonic.prototype;)t.push(...Object.getOwnPropertyNames(e)),e=Object.getPrototypeOf(e);return t}static add(e,t){if(!(t||e.name&&e.name.length>1))throw Error("Mangling. https://bit.ly/2TkJ6zP");if(t||(t=Tonic._splitName(e.name).toLowerCase()),!Tonic.ssr&&window.customElements.get(t))throw new Error(`Cannot Tonic.add(${e.name}, '${t}') twice`);if(!e.prototype||!e.prototype.isTonicComponent){const i={[e.name]:class extends Tonic{}}[e.name];i.prototype.render=e,e=i}return e.prototype._props=Tonic.getPropertyNames(e.prototype),Tonic._reg[t]=e,Tonic._tags=Object.keys(Tonic._reg).join(),window.customElements.define(t,e),typeof e.stylesheet=="function"&&Tonic.registerStyles(e.stylesheet),e}static registerStyles(e){if(Tonic._stylesheetRegistry.includes(e))return;Tonic._stylesheetRegistry.push(e);const t=document.createElement("style");Tonic.nonce&&t.setAttribute("nonce",Tonic.nonce),t.appendChild(document.createTextNode(e())),document.head&&document.head.appendChild(t)}static escape(e){return e.replace(Tonic.ESC,t=>Tonic.MAP[t])}static unsafeRawString(e,t){return new TonicTemplate(e,t,!0)}dispatch(e,t=null){const r={bubbles:!0,detail:t};this.dispatchEvent(new window.CustomEvent(e,r))}html(e,...t){const r=a(s=>{if(s&&s.__children__)return this._placehold(s);if(s&&s.isTonicTemplate)return s.rawText;switch(Object.prototype.toString.call(s)){case"[object HTMLCollection]":case"[object NodeList]":return this._placehold([...s]);case"[object Array]":return s.every(o=>o.isTonicTemplate&&!o.unsafe)?new TonicTemplate(s.join(`
`),null,!1):this._prop(s);case"[object Object]":case"[object Function]":return this._prop(s);case"[object NamedNodeMap]":return this._prop(Tonic._normalizeAttrs(s));case"[object Number]":return`${s}__float`;case"[object String]":return Tonic.escape(s);case"[object Boolean]":return`${s}__boolean`;case"[object Null]":return`${s}__null`;case"[object HTMLElement]":return this._placehold([s])}return typeof s=="object"&&s&&s.nodeType===1&&typeof s.cloneNode=="function"?this._placehold([s]):s},"refs"),i=[];for(let s=0;s<e.length-1;s++)i.push(e[s],r(t[s]));i.push(e[e.length-1]);const n=i.join("").replace(Tonic.SPREAD,(s,o)=>{const h=Tonic._data[o.split("__")[1]][o];return Object.entries(h).map(([p,l])=>{const c=p.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return l===!0?c:l?`${c}="${Tonic.escape(String(l))}"`:""}).filter(Boolean).join(" ")});return new TonicTemplate(n,e,!1)}scheduleReRender(e){return this.pendingReRender?this.pendingReRender:(this.pendingReRender=new Promise(t=>setTimeout(()=>{if(!this.isInDocument(this.shadowRoot||this))return;const r=this._set(this.shadowRoot||this,this.render);if(this.pendingReRender=null,r&&r.then)return r.then(()=>{this.updated&&this.updated(e),t()});this.updated&&this.updated(e),t()},0)),this.pendingReRender)}reRender(e=this.props){const t={...this.props};return this.props=typeof e=="function"?e(t):e,this.scheduleReRender(t)}handleEvent(e){this[e.type](e)}_drainIterator(e,t){return t.next().then(r=>{if(this._set(e,null,r.value),!r.done)return this._drainIterator(e,t)})}_set(e,t,r=""){for(const i of e.querySelectorAll(Tonic._tags)){if(!i.isTonicComponent)continue;const n=i.getAttribute("id");!n||!Tonic._refIds.includes(n)||(Tonic._states[n]=i.state)}if(t instanceof Tonic.AsyncFunction)return t.call(this,this.html,this.props).then(i=>this._apply(e,i));if(t instanceof Tonic.AsyncFunctionGenerator)return this._drainIterator(e,t.call(this));t===null?this._apply(e,r):t instanceof Function&&this._apply(e,t.call(this,this.html,this.props)||"")}_apply(e,t){if(t&&t.isTonicTemplate?t=t.rawText:typeof t=="string"&&(t=Tonic.escape(t)),typeof t=="string"){if(this.stylesheet&&(t=`<style nonce=${Tonic.nonce||""}>${this.stylesheet()}</style>${t}`),e.innerHTML=t,this.styles){const n=this.styles();for(const s of e.querySelectorAll("[styles]"))for(const o of s.getAttribute("styles").split(/\s+/))Object.assign(s.style,n[o.trim()])}const r=Tonic._children[this._id]||{},i=a((n,s)=>{if(n.nodeType===3){const h=n.textContent.trim();r[h]&&s(n,r[h],h)}const o=n.childNodes;if(!!o)for(let h=0;h<o.length;h++)i(o[h],s)},"walk");i(e,(n,s,o)=>{for(const h of s)n.parentNode.insertBefore(h,n);delete Tonic._children[this._id][o],n.parentNode.removeChild(n)})}else e.innerHTML="",e.appendChild(t.cloneNode(!0))}connectedCallback(){this.root=this.shadowRoot||this,super.id&&!Tonic._refIds.includes(super.id)&&Tonic._refIds.push(super.id);const e=a(t=>t.replace(/-(.)/g,(r,i)=>i.toUpperCase()),"cc");for(const{name:t,value:r}of this.attributes){const i=e(t),n=this.props[i]=r;if(/__\w+__\w+__/.test(n)){const{1:s}=n.split("__");this.props[i]=Tonic._data[s][n]}else if(/\d+__float/.test(n))this.props[i]=parseFloat(n,10);else if(n==="null__null")this.props[i]=null;else if(/\w+__boolean/.test(n))this.props[i]=n.includes("true");else if(/placehold:\w+:\w+__/.test(n)){const{1:s}=n.split(":");this.props[i]=Tonic._children[s][n][0]}}if(this.props=Object.assign(this.defaults?this.defaults():{},this.props),this._id=this._id||Tonic._createId(),this.willConnect&&this.willConnect(),!!this.isInDocument(this.root)){if(!this.preventRenderOnReconnect){this._source?this.innerHTML=this._source:this._source=this.innerHTML;const t=this._set(this.root,this.render);if(t&&t.then)return t.then(()=>this.connected&&this.connected())}this.connected&&this.connected()}}isInDocument(e){const t=e.getRootNode();return t===document||t.toString()==="[object ShadowRoot]"}disconnectedCallback(){this.disconnected&&this.disconnected(),delete Tonic._data[this._id],delete Tonic._children[this._id]}}a(Tonic,"Tonic"),Tonic.prototype.isTonicComponent=!0,Object.assign(Tonic,{_tags:"",_refIds:[],_data:{},_states:{},_children:{},_reg:{},_stylesheetRegistry:[],_index:0,version:typeof require!="undefined"?require("./package").version:null,SPREAD:/\.\.\.\s?(__\w+__\w+__)/g,ESC:/["&'<>`/]/g,AsyncFunctionGenerator:async function*(){}.constructor,AsyncFunction:async function(){}.constructor,MAP:{'"':"&quot;","&":"&amp;","'":"&#x27;","<":"&lt;",">":"&gt;","`":"&#x60;","/":"&#x2F;"}}),typeof module=="object"&&(module.exports=Tonic);
